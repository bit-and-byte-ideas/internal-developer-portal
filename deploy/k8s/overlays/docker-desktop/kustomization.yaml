apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: backstage

# Reference the base
resources:
  - ../../base

# Remove ingress for local docker-desktop deployment
# Users will access via port-forward instead
patches:
  # Ensure single replica for local development
  - target:
      kind: Deployment
      name: backstage
    patch: |-
      - op: replace
        path: /spec/replicas
        value: 1

# Remove ingress resource
patchesStrategicMerge:
  - |-
    $patch: delete
    apiVersion: networking.k8s.io/v1
    kind: Ingress
    metadata:
      name: backstage

# Add docker-desktop specific labels
commonLabels:
  environment: local
  deployment: docker-desktop
